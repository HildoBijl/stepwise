FROM shared-build:latest as shared-build
FROM node:16.13.0-alpine as frontend-build
WORKDIR /app
COPY package.json package-lock.json ./
RUN npm ci --quiet
COPY . .
COPY --from=shared-build /app /shared

# Declare build args
ARG REACT_APP_API_ADDRESS
ARG REACT_APP_API_WEBSOCKET_ENDPOINT
ARG REACT_APP_GOOGLE_CLIENT_ID
ARG REACT_APP_GOOGLE_REDIRECT_ADDRESS

ENV REACT_APP_API_ADDRESS=$REACT_APP_API_ADDRESS
ENV REACT_APP_API_WEBSOCKET_ENDPOINT=$REACT_APP_API_WEBSOCKET_ENDPOINT
ENV REACT_APP_GOOGLE_CLIENT_ID=$REACT_APP_GOOGLE_CLIENT_ID
ENV REACT_APP_GOOGLE_REDIRECT_ADDRESS=$REACT_APP_GOOGLE_REDIRECT_ADDRESS

RUN npm run build
